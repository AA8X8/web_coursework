<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head">
  <title>–†–µ—Å—Ç–æ—Ä–∞–Ω—ã - –°—Ç–æ–ª–∏–∫–û–Ω–ª–∞–π–Ω</title>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<main class="container">
  <hgroup>
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
  </hgroup>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ -->
  <div th:if="${successMessage}" class="success-message">
    <p th:text="${successMessage}"></p>
  </div>

  <div th:if="${errorMessage}" class="error-message" style="padding: 1rem; background: #f8d7da; border-radius: 0.5rem;">
    <p th:text="${errorMessage}"></p>
  </div>

  <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
  <form th:action="@{/restaurants/all}" method="get" style="margin-bottom: 2rem;">
    <div class="grid">
      <input type="search"
             name="search"
             th:value="${search}"
             placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫—É—Ö–Ω–µ, –∞–¥—Ä–µ—Å—É..."
             style="flex: 1;">
      <button type="submit" class="secondary">–ü–æ–∏—Å–∫</button>
    </div>

    <div class="grid" style="margin-top: 1rem;">
      <select name="cuisine" onchange="this.form.submit()">
        <option value="">–í—Å–µ –∫—É—Ö–Ω–∏</option>
        <option th:each="cuisine : ${cuisines}"
                th:value="${cuisine}"
                th:text="${cuisine}"
                th:selected="${cuisine == selectedCuisine}"></option>
      </select>

      <select name="priceLevel" onchange="this.form.submit()">
        <option value="">–õ—é–±–∞—è —Ü–µ–Ω–∞</option>
        <option value="1" th:selected="${priceLevel == 1}">üí∞ –ù–∏–∑–∫–∞—è</option>
        <option value="2" th:selected="${priceLevel == 2}">üí∞üí∞ –°—Ä–µ–¥–Ω—è—è</option>
        <option value="3" th:selected="${priceLevel == 3}">üí∞üí∞üí∞ –í—ã—Å–æ–∫–∞—è</option>
      </select>

      <select name="sortBy" onchange="this.form.submit()">
        <option value="name" th:selected="${sortBy == 'name'}">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
        <option value="rating" th:selected="${sortBy == 'rating'}">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
        <option value="priceLevel" th:selected="${sortBy == 'priceLevel'}">–ü–æ —Ü–µ–Ω–µ</option>
      </select>
    </div>
  </form>

  <!-- –°–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ -->
  <div th:if="${restaurants != null and !restaurants.empty}">
    <div class="grid">
      <article th:each="restaurant : ${restaurants}" class="card">
        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –∏–∑–º–µ–Ω–∏–ª–∏ –ø—É—Ç—å —Å /images/ –Ω–∞ /pic/ -->
        <img th:src="${restaurant.photoUrl ?: '/pic/restaurant-default.jpg'}"
             alt="–†–µ—Å—Ç–æ—Ä–∞–Ω"
             class="restaurant-image"
             onerror="this.src='/pic/restaurant-default.jpg'"
             style="width: 100%; height: 200px; object-fit: cover; border-radius: 0.5rem;">
        <div style="margin-top: 1rem;">
          <h3 th:text="${restaurant.name}"></h3>
          <p><span class="cuisine-badge" th:text="${restaurant.cuisine}"></span></p>
          <p>
            <strong>–†–µ–π—Ç–∏–Ω–≥:</strong>
            <span class="rating-stars" th:text="${restaurant.rating} + ' ‚≠ê'"></span>
          </p>
          <p><strong>–ê–¥—Ä–µ—Å:</strong> <span th:text="${restaurant.address}"></span></p>
          <p>
            <strong>–ß–∞—Å—ã:</strong>
            <span th:text="${restaurant.openingTime} + ' - ' + ${restaurant.closingTime}"></span>
          </p>
          <p th:if="${restaurant.priceLevel == 1}"><strong>–¶–µ–Ω–∞:</strong> üí∞ –ù–∏–∑–∫–∞—è</p>
          <p th:if="${restaurant.priceLevel == 2}"><strong>–¶–µ–Ω–∞:</strong> üí∞üí∞ –°—Ä–µ–¥–Ω—è—è</p>
          <p th:if="${restaurant.priceLevel == 3}"><strong>–¶–µ–Ω–∞:</strong> üí∞üí∞üí∞ –í—ã—Å–æ–∫–∞—è</p>

          <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö –ö–ù–û–ü–û–ö - –£–ú–ï–ù–¨–®–ï–ù–ù–´–ô –†–ê–ó–ú–ï–† -->
          <div class="card-buttons">
            <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º name –≤–º–µ—Å—Ç–æ id -->
            <a th:href="@{/restaurants/details/{name}(name=${restaurant.name})}"
               class="secondary">
              –ü–æ–¥—Ä–æ–±–Ω–µ–µ
            </a>
            <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º restaurantName –≤–º–µ—Å—Ç–æ restaurantId -->
            <a th:href="@{/bookings/add(restaurantName=${restaurant.name})}"
               class="contrast">
              –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
            </a>
          </div>
        </div>
      </article>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <nav th:if="${totalPages > 1}" style="margin-top: 2rem;">
      <ul style="display: flex; justify-content: center; gap: 1rem; list-style: none;">
        <li th:if="${currentPage > 0}">
          <a th:href="@{/restaurants/all(page=${currentPage - 1},
                    size=${param.size ?: 10},
                    sortBy=${sortBy},
                    search=${search},
                    cuisine=${selectedCuisine},
                    priceLevel=${priceLevel})}"
             class="outline">
            ‚Üê –ù–∞–∑–∞–¥
          </a>
        </li>
        <li>
          <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ <strong th:text="${currentPage + 1}"></strong> –∏–∑ <strong th:text="${totalPages}"></strong></span>
        </li>
        <li th:if="${currentPage + 1 < totalPages}">
          <a th:href="@{/restaurants/all(page=${currentPage + 1},
                    size=${param.size ?: 10},
                    sortBy=${sortBy},
                    search=${search},
                    cuisine=${selectedCuisine},
                    priceLevel=${priceLevel})}"
             class="outline">
            –í–ø–µ—Ä–µ–¥ ‚Üí
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- –ù–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ -->
  <div th:if="${restaurants == null or restaurants.empty}" class="text-center card">
    <h3>üòî –†–µ—Å—Ç–æ—Ä–∞–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
    <a href="/restaurants/all" class="secondary" style="margin-top: 1rem;">
      –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    </a>
  </div>
</main>

<div th:replace="fragments/footer :: footer"></div>

<style>
  /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
  :root {
    --dark-bg: #1a1a1a;
    --card-bg: #2d2d2d;
    --card-border: #404040;
    --text-primary: #ffffff;
    --text-secondary: #cccccc;
    --accent-color: #3498db;
    --accent-hover: #2980b9;
    --badge-bg: #3a3a3a;
    --success-bg: #155724;
    --error-bg: #721c24;
  }

  /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  body {
    background-color: var(--dark-bg);
    color: var(--text-primary);
  }

  /* –¢–µ–º–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ */
  .card {
    background-color: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 8px;
    padding: 1.5rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    border-color: var(--accent-color);
  }

  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
  .card h3 {
    color: var(--text-primary);
    margin-top: 0;
    font-size: 1.4rem;
    border-bottom: 2px solid var(--accent-color);
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  /* –¢–µ–∫—Å—Ç –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
  .card p {
    color: var(--text-secondary);
    margin: 0.5rem 0;
  }

  /* –ë–µ–π–¥–∂–∏ –∫—É—Ö–Ω–∏ */
  .cuisine-badge {
    background-color: var(--badge-bg);
    color: var(--accent-color);
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9rem;
    border: 1px solid var(--accent-color);
    display: inline-block;
    margin-bottom: 0.5rem;
  }

  /* –ó–≤–µ–∑–¥—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ */
  .rating-stars {
    color: #ffd700; /* –ó–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç –¥–ª—è –∑–≤–µ–∑–¥ */
    font-weight: bold;
    font-size: 1.1rem;
  }

  /* –ö–Ω–æ–ø–∫–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–û (—É–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä) */
  .card-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    width: 100%;
    margin-top: 1.5rem;
  }

  .card-buttons a {
    text-align: center;
    padding: 0.5rem 0.3rem; /* –£–º–µ–Ω—å—à–µ–Ω padding */
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: bold;
    font-size: 0.9rem; /* –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .card-buttons .secondary {
    background-color: #555;
    color: white;
    border: 1px solid #666;
  }

  .card-buttons .secondary:hover {
    background-color: #666;
    border-color: var(--accent-color);
    color: var(--accent-color);
  }

  .card-buttons .contrast {
    background-color: var(--accent-color);
    color: white;
    border: none;
  }

  .card-buttons .contrast:hover {
    background-color: var(--accent-hover);
    transform: scale(1.05);
  }

  /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
  .secondary {
    background-color: #555;
    color: white;
    border: 1px solid #666;
    padding: 0.7rem 1rem;
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-block;
    text-align: center;
    font-weight: bold;
  }

  .secondary:hover {
    background-color: #666;
    border-color: var(--accent-color);
    color: var(--accent-color);
  }

  .contrast {
    background-color: var(--accent-color);
    color: white;
    border: none;
    padding: 0.7rem 1rem;
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-block;
    text-align: center;
    font-weight: bold;
  }

  .contrast:hover {
    background-color: var(--accent-hover);
    transform: scale(1.05);
  }

  /* –°–æ–æ–±—â–µ–Ω–∏—è */
  .success-message {
    background-color: var(--success-bg);
    color: #d4edda;
    padding: 1rem;
    border-radius: 6px;
    border-left: 4px solid #28a745;
    margin-bottom: 1rem;
  }

  .error-message {
    background-color: var(--error-bg);
    color: #f8d7da;
    padding: 1rem;
    border-radius: 6px;
    border-left: 4px solid #dc3545;
    margin-bottom: 1rem;
  }

  /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
  nav ul li a.outline {
    background-color: transparent;
    color: var(--accent-color);
    border: 2px solid var(--accent-color);
    padding: 0.5rem 1rem;
    border-radius: 6px;
  }

  nav ul li a.outline:hover {
    background-color: var(--accent-color);
    color: white;
  }

  /* –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã */
  input, select, button[type="submit"] {
    background-color: var(--card-bg);
    color: var(--text-primary);
    border: 1px solid var(--card-border);
    border-radius: 6px;
    padding: 0.7rem;
  }

  input::placeholder {
    color: #888;
  }

  input:focus, select:focus {
    border-color: var(--accent-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  }

  /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  h1 {
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 0.5rem;
  }

  hgroup p {
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 2rem;
    font-size: 1.1rem;
  }

  /* –ö–æ–≥–¥–∞ –Ω–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ */
  .text-center.card {
    background-color: var(--card-bg);
    border: 2px dashed var(--card-border);
    padding: 2rem;
  }

  .text-center.card h3 {
    color: var(--text-primary);
  }

  .text-center.card p {
    color: var(--text-secondary);
  }

  /* –°–µ—Ç–∫–∞ –≥—Ä–∏–¥–∞ */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }

  /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ */
  .restaurant-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 6px;
    border: 2px solid var(--card-border);
    transition: transform 0.3s ease, border-color 0.3s ease;
  }

  .restaurant-image:hover {
    border-color: var(--accent-color);
    transform: scale(1.02);
  }

  /* –¶–µ–Ω–æ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å */
  p strong {
    color: var(--text-primary);
    margin-right: 0.5rem;
  }

  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
  @media (max-width: 768px) {
    .grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .card-buttons {
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .card-buttons a {
      padding: 0.6rem 0.4rem;
      font-size: 0.9rem;
    }

    .container {
      padding: 1rem;
    }
  }

  @media (max-width: 480px) {
    .card-buttons a {
      font-size: 0.85rem;
      padding: 0.5rem 0.3rem;
    }

    .card h3 {
      font-size: 1.2rem;
    }

    .grid {
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
  }

  @media (max-width: 360px) {
    .card-buttons a {
      font-size: 0.8rem;
      padding: 0.4rem 0.2rem;
    }

    .cuisine-badge {
      font-size: 0.8rem;
      padding: 0.2rem 0.6rem;
    }

    .grid {
      grid-template-columns: 1fr;
    }

    .card {
      padding: 1rem;
    }
  }
</style>
</body>
</html>